/**
 * ngVerify v1.4.9
 *
 * @license: MIT
 * Designed and built by Moer
 * github   https://github.com/Moerj/ngVerify
 *
 */
if("undefined"==typeof angular)throw new Error("ngVerify requires angular");!function(){function isEmptyObject(e){if("object"!=typeof e)return!1;var r;for(r in e)return!1;return!0}function formatOpt(str,iElm){"{"!=str.charAt(0)&&(str="{"+str+"}");try{return eval("("+str+")")}catch(e){console.error("ngVerify options has error:"),console.error(iElm)}}function Init(e){var r=e.ngVerify.$scope,n=e.ngVerify.iAttrs,t=e.ngVerify.OPTS,i={message:"此项为必填",required:!0,option:0,min:n.minlength,max:n.maxlength,errorClass:"verifyError",disabled:!0,least:1,tipStyle:r.ngVerify.tipStyle>=0?r.ngVerify.tipStyle:1};if("radio"==n.type&&t.least&&(console.warn("least is not radio's effective parameter:"),console.warn(e),t.least=i.least),t=angular.extend({},i,t),e.ngVerify.OPTS=t,e.attr({maxlength:t.max,minlength:t.min}),t.control||"submit"==n.type)r.ngVerify.subBtn.push(e),e.on("click",function(){r.ngVerify.submit()});else{r.ngVerify.elems.push(e);var o="checkbox"==n.type||"radio"==n.type,a=angular.element('<div class="verifyTips"><p class="tipStyle-'+t.tipStyle+'"><span class="tipMsg"></span><i></i></p></div>');e.ngVerify.errtip={tip:a.find("p"),message:a.find("span")};var l=e.parent();if(o&&"label"==l[0].localName?(l=l.parent(),l.append(a)):e.after(a),"textarea"==e[0].localName&&1==t.tipStyle&&e.on("click",function(){return e.ngVerify.errtip.tip.css("top",e[0].offsetHeight*-1+"px"),!1}),t.recheck){var s,c=getDom(t.recheck);angular.forEach(r.ngVerify.elems,function(e){if(e[0]===c)return s=e,!1}),s.ngVerify.recheck||(s.ngVerify.recheck={recheckDoms:[]}),s.ngVerify.recheck.recheckDoms.push(e),e.ngVerify.recheck={mainDom:s,getValue:function(){return s[0].value}}}if(bindVaild(e),o)for(var f=document.getElementsByName(n.name),u=0;u<f.length;u++)f[u]!=e[0]&&angular.element(f[u]).on("change",function(){e.triggerHandler("change")})}setTimeout(function(){e[0].addEventListener("DOMNodeRemovedFromDocument",function(){var i;i=t.control||"submit"==n.type?r.ngVerify.subBtn:r.ngVerify.elems;for(var o=0;o<i.length;o++)i[o]==e&&i.splice(o,1);var a=checkAll(r.ngVerify.elems).hasError;DisableButtons(r.ngVerify.subBtn,a)})}),checkAll(r.ngVerify.elems).hasError&&DisableButtons(r.ngVerify.subBtn,!0)}function bindVaild(e){function r(){ISVALID(e)||(tipMsg(e,!1),makeError(e,!0),DisableButtons(t.ngVerify.subBtn,!0))}function n(){var r=ISVALID(e);if(r){var n=checkAll(t.ngVerify.elems);if(DisableButtons(t.ngVerify.subBtn,n.hasError),e.ngVerify.recheck){var i=e.ngVerify.recheck.recheckDoms;if(i)for(var o=0;o<i.length;o++)i[o].val()&&makeError(i[o],!ISVALID(i[o]))}}else DisableButtons(t.ngVerify.subBtn,!0);(e.ngVerify.invalid||s)&&(makeError(e,!r),tipMsg(e,!r))}var t=e.ngVerify.$scope,i=e.ngVerify.scope,o=e.ngVerify.iAttrs,a="",l="",s="checkbox"==o.type||"radio"==o.type;"number"==o.type&&e.on("keypress",function(e){"e"===e.key&&e.preventDefault()}),o.ngModel&&i.$watch(o.ngModel,function(r,t){null==r&&null==t||(null==r||isEmptyObject(r)?e.ngVerify.modelValue=null:e.ngVerify.modelValue="number"==o.type?Number(r):String(r),void 0===e[0].value&&isEmptyObject(r)&&e[0].focus(),n())}),void 0===e[0].value?(a="blur",e.attr("tabindex",0),e.ngVerify.triggerInput=angular.element(e[0].querySelector("input")),e.ngVerify.triggerInput.on("blur",function(){r()}).on("change",function(){n()})):s?l="change":(a="blur",l="change keyup"),e.on(a,function(){r()}).on(l,function(){n()}).on("focus",function(){e.ngVerify.invalid&&tipMsg(e,!0)})}function tipMsg(e,r){var n=e.ngVerify.OPTS;if(0!=n.tipStyle){var t=e.ngVerify.errtip,i=n.errmsg?n.errmsg:n.message;e[0]._verifySetError&&(i=e[0]._verifySetError),t.message.text(i),t.tip.toggleClass("showTip-"+n.tipStyle,r),1==n.tipStyle&&t.tip.css("top",e[0].offsetHeight*-1+"px")}}function makeError(e,r){var n=e.ngVerify.OPTS.errorClass,t=e.parent();e.ngVerify.invalid=r,"checkbox"!=e[0].type&&"radio"!=e[0].type||("label"==t[0].localName&&(t=t.parent()),e=t,e.toggleClass(n+"-dash",r)),e.toggleClass(n,r)}function DisableButtons(e,r){for(var n=0;n<e.length;n++)e[n].ngVerify.OPTS.disabled&&(e[n].prop("disabled",r),"a"===e[n][0].localName&&(console.error(e[n],"<a> tag has no 'disabled' attrbute, please use <button> or <input>."),e[n].css({background:"#bd3a41",color:"#fff"})))}function ISVALID(e){if("none"==e[0].style.display)return!0;if(e[0]._verifySetError)return!1;var r,n,t=e.ngVerify.iAttrs,i=e.ngVerify.OPTS;if("checkbox"==t.type||"radio"==t.type){for(var o=document.getElementsByName(e.attr("name")),a=0,l=0;l<o.length;l++)o[l].checked&&a++;return a>=i.least||(i.message="至少选择"+i.least+"项",!1)}if("select"==e[0].localName)return e[0].selectedIndex!==i.option||(i.message="请选择",!1);if(n=void 0!==e[0].value?null!=e.val()?e.val():e.ngVerify.modelValue:t.ngModel?e.ngVerify.modelValue:e.text(),null==n&&(n=""),n=n.trim(),i.required&&""==n)return"number"==t.type?i.message="需输入数字":i.message="不能为空",!1;if(!i.required&&""==n)return!0;if(n.length<i.min)return i.message="最少"+i.min+"个字符",!1;if(n.length>i.max)return i.message="最多"+i.max+"个字符",!1;if(i.pattern)r=i.pattern,r.name="";else switch(t.type){case"number":r=/^[-+]?\d+(\.\d+)?$/,r.name="数字";break;case"email":r=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/,r.name="邮箱";break;case"phone":r=/^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,r.name="手机号";break;case"url":r=/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:\/~\+#]*[\w\-\@?^=%&amp;\/~\+#])?/,r.name="链接";break;case"char":r=/^[A-Za-z_]+$/,r.name="字符";break;case"dates":r=n.length>10?/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29) (\d{2}):(\d{2})(:(\d{2}))?$/:7===n.length?/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])))$/:/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$/,r.name="日期"}return r?null!=n.match(r)||(i.message=r.name+"格式错误",!1):!i.recheck||n===e.ngVerify.recheck.getValue()||(i.message="两次输入不一致",!1)}function checkAll(e){for(var r={hasError:!1,errEls:[]},n=0;n<e.length;n++)ISVALID(e[n])||r.errEls.push(e[n]);return r.hasError=!!r.errEls.length,r}var m=angular.module("ngVerify",[]);m.service("ngVerify",function(){return{scope:function(e){for(var r,n=document.getElementsByName(e),t=0;t<n.length;t++)if(n[t]._verifyScope){r=n[t]._verifyScope;break}return r},check:function(e,r,n){var t,i=document.getElementsByName(e),o=this;setTimeout(function(){for(var e=0;e<i.length;e++)if(i[e]._verifyScope){var a=o.scope(i[e].name),l=a.ngVerify.elems;if(t=checkAll(l),void 0===n||n===!0||void 0===r)for(var s=t.errEls,c=0;c<s.length;c++)makeError(s[c],!0);DisableButtons(a.ngVerify.subBtn,t.hasError)}"function"==typeof r&&r(t.errEls)})},checkElement:function(e,r){var n=getDom(e);return void 0===n._verifyCheckElement?(console.error(n,"You checked element not a ngVerify's element"),!1):n._verifyCheckElement(r)},setError:function(e,r){var n=getDom(e);n._verifySetError=r,n._verifyCheckElement(!0)}}}),m.directive("verifyScope",function(){return{scope:{},controller:["$scope","$element","$attrs",function(e,r,n){this.getscope=function(){return e},e.ngVerify={elems:[],subBtn:[],tipStyle:formatOpt(n.verifyScope,r).tipStyle,submit:function(){for(var r=e.ngVerify.elems,n=checkAll(r),t=0;t<n.errEls.length;t++)makeError(n.errEls[t],!0)}},r[0]._verifyScope=e}],link:function(e,r){r.attr("novalidate","novalidate")}}}),m.directive("ngVerify",["ngVerify",function(e){return{require:"?^verifyScope",scope:!1,link:function(r,n,t,i){var o,a=formatOpt(t.ngVerify,n);if(void 0!=i)o=i.getscope(),n[0]._verifyCheckElement=function(e){return makeError(n,e),ISVALID(n)};else{if(!a.control)return console.error("ngVerify need control option to form.name:"),void console.error(n);if(o=e.scope(a.control),void 0==o)return console.error("ngVerify button cant be find parent form:"),void console.error(n)}n.ngVerify={$scope:o,scope:r,iAttrs:t,OPTS:a},Init(n)}}}]);var getDom=function(e){var r;return"object"==typeof e&&(r=e),"string"==typeof e&&(0===e.indexOf("#")?(e=e.slice(1,e.length),r=document.getElementById(e)):angular.forEach(document.getElementsByName(e),function(e){if(void 0!==angular.element(e).attr("ng-verify"))return r=e,!1})),null==r?console.error("param:'"+e+"' can not find dom element"):r}}();